
#include <stdio.h>
#include "sdkconfig.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "esp_system.h"
#include "esp_spi_flash.h"
#include "E-link/EPaperDrive.h"
#include "E-link/FileSystem.h"
#include "Screens/ExamScheduling.h"
#include "Screens/Todo.h"
#include "Wifi/wifi.h"

void app_main(void)
{
      vTaskDelay(2 / portTICK_PERIOD_MS);
      printf("Hello \n");
      fflush(stdout);
      // 驱动库的实例化，此处为使用软件SPI
      extern gpio_num_t CS;
      extern gpio_num_t RST;
      extern gpio_num_t DC;
      extern gpio_num_t BUSY_line;
      extern gpio_num_t CLK;
      extern gpio_num_t DIN;
      extern uint8_t EPDbuffer[400 * 300 / 8]; ///>屏幕图像
      // 初始化wifi
      wifi_init_all();
      vTaskDelay(1000 / portTICK_PERIOD_MS);
      EPaperDrive(CS, RST, DC, BUSY_line, CLK, DIN);
      LittlefsBegin();
// const uint8_t image_data[]={0xaa,0xff,0x48,0,0xff,0,0xaa,0,0x48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xc0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0xff,0xc0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0x0e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0x07,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x0e,0,0x70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0x03,0x80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x1c,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x0e,0,0,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x70,0,0x1c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x1c,0,0,0x70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0xe0,0,0x1c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x1c,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xc0,0,0x0e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x38,0,0,0x1e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0x07,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x78,0,0,0x07,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x0e,0,0,0x07,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x70,0,0,0x03,0x80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x1c,0,0,0x03,0x80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x70,0,0,0x01,0xc0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x38,0,0,0x03,0x80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0xe0,0,0,0,0xf0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0xf0,0,0,0x01,0xc0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0xe0,0,0,0,0x78,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xe0,0,0,0x01,0xc0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xe0,0,0,0,0x1c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0,0x01,0xc0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xc0,0,0,0,0x0f,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xc0,0,0,0,0x07,0x80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x1e,0,0,0,0,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x01,0xc0,0,0,0,0x03,0xc0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x3c,0,0,0,0,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0xc0,0,0,0,0,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x70,0,0,0,0,0x70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0,0,0,0x78,0,0,0,0,0,0,0x0f,0xff,0xff,0xff,0,0,0,0,0,0,0x01,0xe0,0,0,0,0,0x70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0,0,0,0x3c,0,0,0,0,0,0x7f,0xff,0xff,0xff,0xff,0xff,0xf0,0,0,0,0,0x03,0xc0,0,0,0,0,0x70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0,0,0,0x1e,0,0,0,0,0x7f,0xff,0xfe,0,0x07,0xff,0xff,0xff,0xf0,0,0,0,0x07,0x80,0,0,0,0,0x70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0,0,0,0x07,0,0,0,0x3f,0xff,0xf0,0,0,0,0,0,0xff,0xff,0xc0,0,0,0x0e,0,0,0,0,0,0x78,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x03,0x80,0,0,0,0,0x03,0xc0,0,0x03,0xff,0xe0,0,0,0,0,0,0,0,0x7f,0xfc,0,0,0x3c,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0xe0,0,0x3f,0xf8,0,0,0,0,0,0,0,0,0x01,0xff,0xc0,0,0x78,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0x78,0x03,0xff,0,0,0,0,0,0,0,0,0,0,0x0f,0xfc,0,0xe0,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0x1c,0x1f,0xf0,0,0,0,0,0,0,0,0,0,0,0,0x7f,0x83,0xc0,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0x07,0xfe,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0xff,0,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0x03,0xf0,0,0,0,0,0,0,0,0,0,0,0,0,0,0xfc,0,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0x0f,0x80,0,0,0,0,0,0,0,0,0,0,0,0,0,0x1c,0,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0x3c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x07,0,0,0,0,0,0,0xe0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};      // /*   墨水屏测试成功
      // ExamSchedue();
	EPD_init_Full();                       // 全刷初始化，使用全刷波形
      vTaskDelay(3000 / portTICK_PERIOD_MS);
         extern uint8_t fontscale;
         fontscale=1;
          clearbuffer();   // 清空缓存(全白)

	//获取剩余的iram大小
	size_t iram = heap_caps_get_free_size(MALLOC_CAP_32BIT) - heap_caps_get_free_size(MALLOC_CAP_8BIT);

	//获取栈区的最高水位线(也就是栈顶，意味着最大栈区空间)
	int stackmark=uxTaskGetStackHighWaterMark(NULL);
	printf("iram=%d\n", iram);
	printf("stackmark=%d\n", stackmark);
      //     char * p = (char *)malloc(1500);
      //     free(p);
      // DrawXbm_P(0,0,400,300,(uint8_t *)image_data);

      //    EPD_Dis_Full((uint8_t *)image_data, 1); // 将缓存中的图像传给屏幕控制芯片全刷屏幕
      // for (int i = 0; i < 3; i++)
      // {


      // vTaskDelay(10000 / portTICK_PERIOD_MS);
      // //模式切换时，需要多等一会几秒完全刷新好才行。
      // EPD_init_Part();
      // clearbuffer(); // 清空缓存(全白)
      // DrawUTF(26, 0, "这是局部刷新效果显示");         
      // DrawUTF(46, 0, "1234567890");    
      // // vTaskDelay(3000 / portTICK_PERIOD_MS);
      // EPD_Dis_Part(0, 100, 0, 300, 1); // 将缓存中的图像传给屏幕控制芯片局新屏幕
      // deepsleep();
      // vTaskDelay(3000 / portTICK_PERIOD_MS);
      // }
}
